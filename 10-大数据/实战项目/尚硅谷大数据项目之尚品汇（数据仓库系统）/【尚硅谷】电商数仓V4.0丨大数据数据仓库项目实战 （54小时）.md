# 【尚硅谷】电商数仓V4.0丨大数据数据仓库项目实战
（54小时）

## 1-尚硅谷大数据项目之尚品汇（用户行为采集平台）V4.1.0

### 第1章 数据仓库概念

### 第2章 项目需求及架构设计

- 2.1 项目需求分析
- 2.2 项目框架

	- 2.2.1 技术选型
	- 2.2.2 系统数据流程设计
	- 2.2.3 框架版本选型
	- 2.2.4服务器选型
	- 2.2.5 集群规模
	- 2.2.6 集群资源规划设计

### 第3章 数据生成模块

- 3.1 目标数据

	- 3.1.1 页面
	- 3.1.2 事件
	- 3.1.3 曝光
	- 3.1.4 启动
	- 3.1.5 错误

- 3.2 数据埋点

	- 3.2.1 主流埋点方式（了解）
	- 3.2.3 埋点数据日志结构

- 3.3 服务器和JDK准备

	- 3.3.1 服务器准备
	- 3.3.2 阿里云服务器准备（可选）
	- 3.3.3 编写集群分发脚本xsync
	- 3.3.4 SSH无密登录配置
	- 3.3.5 JDK准备
	- 3.3.6 环境变量配置说明

- 3.4 模拟数据

	- 3.4.1 使用说明
	- 3.4.2 集群日志生成脚本

### 第4章 数据采集模块

- 4.1 集群所有进程查看脚本
- 4.2 Hadoop安装

	- 4.2.1 项目经验之HDFS存储多目录
	- 4.2.2 集群数据均衡
	- 4.2.3 项目经验之支持LZO压缩配置
	- 4.2.4 项目经验之LZO创建索引
	- 4.2.5 项目经验之基准测试
	- 4.2.6 项目经验之Hadoop参数调优

- 4.3 Zookeeper安装

	- 4.3.1 安装ZK
	- 4.3.2 ZK集群启动停止脚本

- 4.4 Kafka安装

	- 4.4.1 Kafka集群安装
	- 4.4.2 Kafka集群启动停止脚本
	- 4.4.3 Kafka常用命令
	- 4.4.4 项目经验之Kafka机器数量计算
	- 4.4.5 项目经验之Kafka压力测试
	- 4.4.6 项目经验值Kafka分区数计算

- 4.5 采集日志Flume

	- 4.5.1 日志采集Flume安装
	- 4.5.2 项目经验之Flume组件选型
	- 4.5.3 日志采集Flume配置
	- 4.5.4 Flume拦截器
	- 4.5.5 测试Flume-Kafka通道

- 4.6 消费Kafka数据Flume

	- 4.6.1 项目经验之Flume组件选型
	- 4.6.2 消费者Flume配置
	- 4.6.3 Flume时间戳拦截器
	- 4.6.4 消费者Flume启动停止脚本
	- 4.6.5 项目经验之Flume内存优化

- 4.7 采集通道启动/停止脚本

### 第5章 常见问题及解决方案

- 5.1 2NN页面不能显示完整信息

## 2-尚硅谷大数据项目之尚品汇（业务数据采集平台）V4.1.0

### 第1章 电商业务简介

- 1.1 电商业务流程
- 1.2 电商常识

	- 1.2.1 SKU和SPU
	- 1.2.2 平台属性和销售属性

- 1.3 电商系统表结构

	- 1.3.1 活动信息表（activity_info）
	- 1.3.2 活动规则表（activity_rule）
	- 1.3.3 活动商品关联表（activity_sku）
	- 1.3.4 平台属性表（base_attr_info）
	- 1.3.5 平台属性值表（base_attr_value）
	- 1.3.6 一级分类表（base_category1）
	- 1.3.7 二级分类表（base_category2）
	- 1.3.8 三级分类表（base_category3）
	- 1.3.9 字典表（base_dic）
	- 1.3.10 省份表（base_province）
	- 1.3.11 地区表（base_region）
	- 1.3.12 品牌表（base_trademark）
	- 1.3.13 购物车表（cart_info）
	- 1.3.14 评价表（comment_info）
	- 1.3.15 优惠券信息表（coupon_info）
	- 1.3.16 优惠券优惠范围表（coupon_range）
	- 1.3.17 优惠券领用表（coupon_use）
	- 1.3.18 收藏表（favor_info）
	- 1.3.19 订单明细表（order_detail）
	- 1.3.20 订单明细活动关联表（order_detail_activity）
	- 1.3.21 订单明细优惠券关联表（order_detail_coupon）
	- 1.3.22 订单表(order_info）
	- 1.3.23 退单表（order_refund_info）
	- 1.3.24 订单状态流水表（order_status_log）
	- 1.3.25 支付表（payment_info）
	- 1.3.26 退款表（refund_payment）
	- 1.3.27 SKU平台属性表（sku_attr_value）
	- 1.3.28 SKU信息表（sku_info）
	- 1.3.29 SKU销售属性表（sku_sale_attr_value）
	- 1.3.30 SPU信息表（spu_info）
	- 1.3.31 SPU销售属性表（spu_sale_attr）
	- 1.3.32 SPU销售属性值表（spu_sale_attr_value）
	- 1.3.33 用户地址表（user_address）
	- 1.3.34 用户信息表（user_info）

### 第2章 业务数据采集模块

- 2.1 MySQL安装

	- 2.1.1 安装包准备
	- 2.1.2 安装MySQL
	- 2.1.3 配置MySQL

- 2.2 业务数据生成

	- 2.2.1 连接MySQL
	- 2.2.2 建表语句
	- 2.2.3 生成业务数据
	- 2.2.4 业务数据建模

- 2.3 Sqoop安装

	- 2.3.1 下载并解压
	- 2.3.2 修改配置文件
	- 2.3.3 拷贝JDBC驱动
	- 2.3.4 验证Sqoop
	- 2.3.5 测试Sqoop是否能够成功连接数据库
	- 2.3.6 Sqoop基本使用

- 2.4 同步策略

	- 2.4.1 全量同步策略
	- 2.4.2 增量同步策略
	- 2.4.3 新增及变化策略
	- 2.4.4 特殊策略

- 2.5 业务数据导入HDFS

	- 2.5.1 分析表同步策略
	- 2.5.2 业务数据首日同步脚本
	- 2.5.3 业务数据每日同步脚本
	- 2.5.4 项目经验

### 第3章 数据环境准备

- 3.1 Hive安装部署
- 3.2 Hive元数据配置到MySQL

	- 3.2.1 拷贝驱动
	- 3.2.2 配置Metastore到MySQL

- 3.3 启动Hive

	- 3.3.1 初始化元数据库
	- 3.3.2 启动Hive客户端

## 3-尚硅谷大数据项目之尚品汇（数据仓库系统）V4.2.0

### 第1章 数仓分层

- 1.1 为什么要分层
- 1.2 数据集市与数据仓库概念
- 1.3 数仓命名规范

	- 1.3.1 表命名
	- 1.3.2 脚本命名
	- 1.3.3 表字段类型

### 第2章 数仓理论

- 2.1 范式理论

	- 2.1.1 范式概念
	- 2.1.2 函数依赖
	- 2.1.3 三范式区分

- 2.2 关系建模与维度建模

	- 2.2.1 关系建模

	  关系模型严格遵循第三范式（3NF），数据冗余程度低，数据的一致性容易得到保证。由于数据分布于众多的表中，查询会相对复杂，在大数据的场景下，查询效率相对较低。
	  

	- 2.2.2 维度建模

	  维度模型以数据分析作为出发点，不遵循三范式，故数据存在一定的冗余。维度模型面向业务，将业务用事实表和维度表呈现出来。表结构简单，故查询简单，查询效率较高。
	  

- 2.3 维度表和事实表（重点）

	- 2.3.1 维度表
	- 2.3.2 事实表

- 2.4 维度模型分类
- 2.5 数据仓库建模（绝对重点）

	- 2.5.1 ODS层

		- 1）HDFS用户行为数据
		- 2）HDFS业务数据
		- 3）针对HDFS上的用户行为数据和业务数据，我们如何规划处理？

		  （1）保持数据原貌不做任何修改，起到备份数据的作用。
		  （2）数据采用压缩，减少磁盘存储空间（例如：原始数据100G，可以压缩到10G左右）
		  （3）创建分区表，防止后续的全表扫描
		  

	- 2.5.2 DIM层和DWD层

	  DIM层DWD层需构建维度模型，一般采用星型模型，呈现的状态一般为星座模型。
	  维度建模一般按照以下四个步骤：
	  选择业务过程→声明粒度→确认维度→确认事实
	  

		- （1）选择业务过程
		- （2）声明粒度
		- （3）确定维度
		- （4）确定事实

	- 2.5.3 DWS层与DWT层

	  DWS层和DWT层统称宽表层，这两层的设计思想大致相同，通过以下案例进行阐述。
	  1）问题引出：两个需求，统计每个省份订单的个数、统计每个省份订单的总金额
	  2）处理办法：都是将省份表和订单表进行join，group by省份，然后计算。同样数据被计算了两次，实际上类似的场景还会更多。
	  那怎么设计能避免重复计算呢？
	  针对上述场景，可以设计一张地区宽表，其主键为地区ID，字段包含为：下单次数、下单金额、支付次数、支付金额等。上述所有指标都统一进行计算，并将结果保存在该宽表中，这样就能有效避免数据的重复计算。
	  3）总结：
	  （１）需要建哪些宽表：以维度为基准。
	  （２）宽表里面的字段：是站在不同维度的角度去看事实表，重点关注事实表聚合后的度量值。
	  （３）DWS和DWT层的区别：DWS层存放的所有主题对象当天的汇总行为，例如每个地区当天的下单次数，下单金额等，DWT层存放的是所有主题对象的累积行为，例如每个地区最近７天（１５天、３０天、６０天）的下单次数、下单金额等。
	  

	- 2.5.4 ADS层

	  对电商系统各大主题指标分别进行分析。
	  

### 第3章 数仓环境搭建

- 3.1 Hive环境搭建

	- 3.1.1 Hive引擎简介
	- 3.1.2 Hive on Spark配置
	- 3.1.3 Hive on Spark测试

- 3.2 Yarn配置

	- 3.2.1 增加ApplicationMaster资源比例

- 3.3 数仓开发环境
- 3.4 数据准备

### 第4章 数仓搭建-ODS层

1）保持数据原貌不做任何修改，起到备份数据的作用。
2）数据采用LZO压缩，减少磁盘存储空间。100G数据可以压缩到10G以内。
3）创建分区表，防止后续的全表扫描，在企业开发中大量使用分区表。
4）创建外部表。在企业开发中，除了自己用的临时表，创建内部表外，绝大多数场景都是创建外部表。


- 4.1 ODS层（用户行为数据）

	- 4.1.1 创建日志表ods_log
	- 4.1.2 Shell中单引号和双引号区别
	- 4.1.3 ODS层日志表加载数据脚本

- 4.2 ODS层（业务数据）

	- 4.2.1 活动信息表
	- 4.2.2 活动规则表
	- 4.2.3 一级品类表
	- 4.2.4 二级品类表
	- 4.2.5 三级品类表
	- 4.2.6 编码字典表
	- 4.2.7 省份表
	- 4.2.8 地区表
	- 4.2.9 品牌表
	- 4.2.10 购物车表
	- 4.2.11 评论表
	- 4.2.12 优惠券信息表
	- 4.2.13 优惠券领用表
	- 4.2.14 收藏表
	- 4.2.15 订单明细表
	- 4.2.16 订单明细活动关联表
	- 4.2.17 订单明细优惠券关联表
	- 4.2.18 订单表
	- 4.2.19 退单表
	- 4.2.20 订单状态日志表
	- 4.2.21 支付表
	- 4.2.22 退款表
	- 4.2.23 商品平台属性表
	- 4.2.24 商品（SKU）表
	- 4.2.25 商品销售属性表
	- 4.2.26 商品（SPU）表
	- 4.2.27 用户表
	- 4.2.28 ODS层业务表首日数据装载脚本
	- 4.2.29 ODS层业务表每日数据装载脚本

### 第5章 数仓搭建-DIM层

- 5.1 商品维度表（全量）
- 5.2 优惠券维度表（全量）
- 5.3 活动维度表（全量）
- 5.4 地区维度表（特殊）
- 5.5 时间维度表（特殊）
- 5.6 用户维度表（拉链表）

	- 5.6.1 拉链表概述

- 5.7 DIM层首日数据装载脚本
- 5.8 DIM层每日数据装载脚本

### 第6章 数仓搭建-DWD层

- 6.1 DWD层（用户行为日志）

	- 6.1.1 日志解析思路
	- 6.1.2 get_json_object函数使用
	- 6.1.3 启动日志表
	- 6.1.4 页面日志表
	- 6.1.5 动作日志表
	- 6.1.6 曝光日志表
	- 6.1.7 错误日志表

- 6.2 DWD层（业务数据）

	- 6.2.1 评价事实表（事务型事实表）
	- 6.2.2 订单明细事实表（事务型事实表）
	- 6.2.3 退单事实表（事务型事实表）
	- 6.2.4 加购事实表（周期型快照事实表，每日快照）
	- 6.2.5 收藏事实表（周期型快照事实表，每日快照）
	- 6.2.6 优惠券领用事实表（累积型快照事实表）
	- 6.2.7 支付事实表（累积型快照事实表）
	- 6.2.8 退款事实表（累积型快照事实表）
	- 6.2.9 订单事实表（累积型快照事实表）
	- 6.2.10 DWD层业务数据首日装载脚本
	- 6.2.11 DWD层业务数据每日装载脚本

### 第7章 数仓搭建-DWS层

- 7.1 系统函数

	- 7.1.1 nvl函数
	- 7.1.2 日期处理函数
	- 7.1.3 复杂数据类型定义

- 7.2 DWS层

	- 7.2.1 访客主题
	- 7.2.2 用户主题
	- 7.2.3 商品主题
	- 7.2.4 优惠券主题
	- 7.2.5 活动主题
	- 7.2.6 地区主题
	- 7.2.7 DWS层首日数据装载脚本
	- 7.2.8 DWS层每日数据装载脚本

### 第8章 数仓搭建-DWT层

- 8.1 访客主题
- 8.2 用户主题
- 8.3 商品主题
- 8.4 优惠券主题
- 8.5 活动主题
- 8.6 地区主题
- 8.7 DWT层首日数据导入脚本
- 8.8 DWT层每日数据导入脚本

### 第9章 数仓搭建-ADS层

- 9.1 建表说明
- 9.2 访客主题

	- 9.2.1 访客统计
	- 9.2.2 路径分析

- 9.3 用户主题

	- 9.3.1 用户统计
	- 9.3.2 用户变动统计
	- 9.3.3 用户行为漏斗分析
	- 9.3.4 用户留存率

- 9.4 商品主题

	- 9.4.1 商品统计
	- 9.4.2 品牌复购率

- 9.5 订单主题

	- 9.5.1 订单统计
	- 9.5.2 各地区订单统计

- 9.6 优惠券主题

	- 9.6.1 优惠券统计

- 9.7 活动主题

	- 9.7.1 活动统计

- 9.8 ADS层业务数据导入脚本

### 第10章 全流程调度

- 10.1 Azkaban部署
- 10.2 创建MySQL数据库和表
- 10.3 Sqoop导出脚本
- 10.4 全调度流程

	- 10.4.1 数据准备
	- 10.4.2 编写Azkaban工作流程配置文件
	- 10.4.3 Azkaban多Executor模式下注意事项

*XMind - Trial Version*